package org.micromanager.explore.gui;

import javax.swing.DefaultCellEditor;
import javax.swing.JTextField;
import javax.swing.SwingConstants;
import javax.swing.table.DefaultTableCellRenderer;

import org.micromanager.explore.ExploreOverlayer;
import org.micromanager.explore.XYTiledAcqViewerStorageAdapater;
import org.micromanager.ndviewer.api.ControlsPanelInterface;

/**
 *
 * @author henrypinkard
 */
public class ExploreControlsPanel extends javax.swing.JPanel implements ControlsPanelInterface {

   private ChannelGroupSettings channels_; 
   private XYTiledAcqViewerStorageAdapater manager_;
   private ExploreZSliders zSliders_;
   private ExploreOverlayer overlayer_;

   /**
    * Creates new form ExploreChannelsPanel.
    */
   public ExploreControlsPanel(XYTiledAcqViewerStorageAdapater manager, ExploreOverlayer overlayer,
                               ChannelGroupSettings channels) {
      channels_ = channels;
      overlayer_ = overlayer;
      manager_ = manager;
      zSliders_ = new ExploreZSliders(manager);
      initComponents();


      //left justified editor
      JTextField tf = new JTextField();
      tf.setHorizontalAlignment(SwingConstants.LEFT);
      DefaultCellEditor ed = new DefaultCellEditor(tf);
      channelsTable_.getColumnModel().getColumn(2).setCellEditor(ed);
      //and renderer
      DefaultTableCellRenderer renderer = new DefaultTableCellRenderer();
      renderer.setHorizontalAlignment(SwingConstants.LEFT); // left justify
      channelsTable_.getColumnModel().getColumn(2).setCellRenderer(renderer);
      channelsTable_.getColumnModel().getColumn(0).setMaxWidth(30); //Acitve checkbox column
      if (channels_ == null) {
         jScrollPane2.setVisible(false);
         selectUseAllButton_.setVisible(false);
         syncExposuresButton_.setVisible(false);
      }
   }
   
   public void updateControls(Integer zIndex) {
      zSliders_.updateExploreZControls(zIndex);
   }

   @Override
   public void selected() {
      overlayer_.setActive(true);
   }
   
   @Override
   public void deselected() {
      overlayer_.setActive(false);
   }

   @Override
   public String getTitle() {
      return "Explore controls";
   }

   @Override
   public void close() {
      manager_ = null;
      channelsTable_ = null;
      zSliders_.onDisplayClose();
      zSliders_ = null;
   }



   /**
    * This method is called from within the constructor to initialize the form.
    * WARNING: Do NOT modify this code. The content of this method is always
    * regenerated by the Form Editor.
    */
   @SuppressWarnings("unchecked")
   // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
   private void initComponents() {

      zPanelPanel_ = new javax.swing.JPanel();
      zPanelPanel_.add(zSliders_);
      jPanel2 = new javax.swing.JPanel();
      jPanel1 = new javax.swing.JPanel();
      acquireAtCurrentButton_ = new javax.swing.JButton();
      selectUseAllButton_ = new javax.swing.JButton();
      syncExposuresButton_ = new javax.swing.JButton();
      jScrollPane2 = new javax.swing.JScrollPane();
      channelsTable_ = new javax.swing.JTable();

      zPanelPanel_.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT, 0, 0));

      jPanel1.setLayout(new java.awt.FlowLayout(java.awt.FlowLayout.LEFT));

      acquireAtCurrentButton_.setText("Acquire at current position");
      acquireAtCurrentButton_.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            acquireAtCurrentButtonActionPerformed(evt);
         }
      });
      jPanel1.add(acquireAtCurrentButton_);

      selectUseAllButton_.setText("Select all");
      selectUseAllButton_.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            selectUseAllButtonActionPerformed(evt);
         }
      });
      jPanel1.add(selectUseAllButton_);

      syncExposuresButton_.setText("Sync exposures");
      syncExposuresButton_.addActionListener(new java.awt.event.ActionListener() {
         public void actionPerformed(java.awt.event.ActionEvent evt) {
            syncExposuresButtonActionPerformed(evt);
         }
      });
      jPanel1.add(syncExposuresButton_);

      channelsTable_.setModel(new SimpleChannelTableModel(channels_));
      jScrollPane2.setViewportView(channelsTable_);

      javax.swing.GroupLayout jPanel2Layout = new javax.swing.GroupLayout(jPanel2);
      jPanel2.setLayout(jPanel2Layout);
      jPanel2Layout.setHorizontalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
            .addContainerGap()
            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE,
                  javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
            .addComponent(jScrollPane2, javax.swing.GroupLayout.Alignment.TRAILING)
      );
      jPanel2Layout.setVerticalGroup(
            jPanel2Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel2Layout.createSequentialGroup()
            .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE,
                  javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE,
                  298, Short.MAX_VALUE))
      );

      javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
      this.setLayout(layout);
      layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(zPanelPanel_, javax.swing.GroupLayout.DEFAULT_SIZE,
                  javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE,
                  javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
      );
      layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
            .addComponent(zPanelPanel_, javax.swing.GroupLayout.PREFERRED_SIZE,
                  javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
            .addComponent(jPanel2, javax.swing.GroupLayout.DEFAULT_SIZE,
                  javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
      );
   } // </editor-fold>//GEN-END:initComponents

   private void syncExposuresButtonActionPerformed(java.awt.event.ActionEvent evt) {
      ((SimpleChannelTableModel) channelsTable_.getModel()).synchronizeExposures();
      ((SimpleChannelTableModel) channelsTable_.getModel()).fireTableDataChanged();
   } //GEN-LAST:event_syncExposuresButton_ActionPerformed

   private void selectUseAllButtonActionPerformed(java.awt.event.ActionEvent evt) {
      ((SimpleChannelTableModel) channelsTable_.getModel()).selectAllChannels();
      ((SimpleChannelTableModel) channelsTable_.getModel()).fireTableDataChanged();
   } //GEN-LAST:event_selectUseAllButton_ActionPerformed

   private void acquireAtCurrentButtonActionPerformed(java.awt.event.ActionEvent evt) {
      manager_.acquireTileAtCurrentPosition();
   } //GEN-LAST:event_acquireAtCurrentButton_ActionPerformed


   // Variables declaration - do not modify//GEN-BEGIN:variables
   private javax.swing.JButton acquireAtCurrentButton_;
   private javax.swing.JTable channelsTable_;
   private javax.swing.JPanel jPanel1;
   private javax.swing.JPanel jPanel2;
   private javax.swing.JScrollPane jScrollPane2;
   private javax.swing.JButton selectUseAllButton_;
   private javax.swing.JButton syncExposuresButton_;
   private javax.swing.JPanel zPanelPanel_;
   // End of variables declaration//GEN-END:variables


}
